---
import { getCollection } from 'astro:content';

// Check if there are any published blog posts
const publishedPosts = await getCollection('blog', ({ data }) => !data.draft);
const hasBlogPosts = publishedPosts.length > 0;

const navLinks = [
  { href: '/#inicio', label: 'Inicio' },
  { href: '/#servicios', label: 'Servicios' },
  { href: '/#acerca', label: 'Acerca de mí' },
  { href: '/#experiencia', label: 'Experiencia' },
  ...(hasBlogPosts ? [{ href: '/blog/', label: 'Blog' }] : []),
];
---

<header class="fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-md border-b border-border">
  <nav class="container mx-auto px-4 h-16 flex items-center justify-between">
    <!-- Logo - rosa (hoja) + verde/crema (texto según tema) -->
    <a href="/" class="group flex items-center gap-2">
      <svg
        class="w-6 h-6 sm:w-7 sm:h-7 text-rosa-500 dark:text-rosa-400 transition-colors group-hover:text-rosa-400 dark:group-hover:text-rosa-300"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/>
        <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/>
      </svg>
      <span class="logo-brand-name text-[1.35rem] sm:text-2xl text-verde-600 dark:text-crema-100 transition-colors group-hover:text-verde-500 dark:group-hover:text-white">
        Jessica
      </span>
      <span class="logo-brand-surname text-[1.35rem] sm:text-2xl text-verde-600 dark:text-crema-100 transition-colors group-hover:text-verde-500 dark:group-hover:text-white">
        Méndez
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-8">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors"
        >
          {link.label}
        </a>
      ))}
      <a
        href="/#contacto"
        class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 bg-verde-600 hover:bg-verde-700 dark:bg-verde-500 dark:hover:bg-verde-400 text-white dark:text-verde-950 transition-colors"
      >
        Contactar
      </a>
      <!-- Theme Toggle Desktop -->
      <button
        id="theme-toggle-desktop"
        class="p-2 rounded-md border border-border hover:bg-muted transition-colors cursor-pointer"
        aria-label="Cambiar tema"
      >
        <svg class="sun-icon w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="menu-toggle"
      class="md:hidden p-2 text-primary"
      aria-label="Abrir menú"
      aria-expanded="false"
    >
      <svg class="menu-icon w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
      <svg class="close-icon w-7 h-7 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu md:hidden hidden">
    <div class="container mx-auto px-4 py-6 flex flex-col gap-2">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class="mobile-link block py-3 px-4 text-base font-medium text-foreground hover:text-primary hover:bg-muted/50 rounded-lg transition-colors"
        >
          {link.label}
        </a>
      ))}
      <a
        href="/#contacto"
        class="mobile-link mt-4 flex items-center justify-center py-3 px-4 rounded-lg text-base font-semibold bg-verde-600 hover:bg-verde-700 dark:bg-verde-500 dark:hover:bg-verde-400 text-white dark:text-verde-950 transition-colors"
      >
        Contactar
      </a>

      <!-- Theme Toggle Mobile -->
      <div class="mt-6 pt-4 border-t border-border flex items-center justify-between">
        <span class="text-sm text-muted-foreground">Tema</span>
        <button
          id="theme-toggle-mobile"
          class="p-2 rounded-md border border-border hover:bg-muted transition-colors cursor-pointer"
          aria-label="Cambiar tema"
        >
          <svg class="sun-icon w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg class="moon-icon w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<style>
  .mobile-menu {
    background: hsl(var(--background));
    border-bottom: 1px solid hsl(var(--border));
  }

  /* Dark mode icon toggle */
  :global(.dark) .sun-icon {
    display: none;
  }
  :global(.dark) .moon-icon {
    display: block;
  }
</style>

<script>
  function initHeader() {
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const themeToggleDesktop = document.getElementById('theme-toggle-desktop');
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');
    const mobileLinks = document.querySelectorAll('.mobile-link');

    if (!menuToggle || !mobileMenu) return;

    const menuIcon = menuToggle.querySelector('.menu-icon');
    const closeIcon = menuToggle.querySelector('.close-icon');

    // Toggle mobile menu
    menuToggle.addEventListener('click', () => {
      const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';

      menuToggle.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.classList.toggle('hidden');
      menuIcon?.classList.toggle('hidden');
      closeIcon?.classList.toggle('hidden');
    });

    // Close menu when clicking links
    mobileLinks.forEach(link => {
      link.addEventListener('click', () => {
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileMenu.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
      });
    });

    // Theme toggle function
    const toggleTheme = () => {
      const isDark = document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', !isDark);
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    };

    themeToggleDesktop?.addEventListener('click', toggleTheme);
    themeToggleMobile?.addEventListener('click', toggleTheme);
  }

  // Run on initial load
  initHeader();

  // Re-run after Astro page transitions
  document.addEventListener('astro:after-swap', initHeader);
</script>
